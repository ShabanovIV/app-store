"use strict";(self.webpackChunkapp_store=self.webpackChunkapp_store||[]).push([[337],{1420:(e,t,r)=>{var s;r.d(t,{R:()=>s}),function(e){e.PendingConfirmation="pending_confirmation",e.Processing="processing",e.Packaging="packaging",e.WaitingForDelivery="waiting_for_delivery",e.InTransit="in_transit",e.Delivered="delivered",e.ReturnRequested="return_requested",e.OrderCancelled="order_cancelled"}(s||(s={}))},8337:(e,t,r)=>{r.r(t),r.d(t,{default:()=>P});var s=r(4848),n=r(6552),i=r(515),c=r(4753),o=r(429),a=r(294),d=r(4700),l=r(4274);const u={checkoutContainer:"Checkout-module_checkoutContainer-YEQ2J",summary:"Checkout-module_summary-V1wtx",oldPrice:"Checkout-module_oldPrice-mRnhp",discount:"Checkout-module_discount-q0fSi"};var m=r(1420),h=r(8931),p=r(2565),f=r(6540),x=r(7094),j=r(7231),v=r(1458);const y=()=>{var e;const{products:t,order:r}=(()=>{var e;const t=(0,p.G)((e=>(0,h.Fs)(e))),r=Object.keys(t),{data:s,isFetching:n}=(0,o.Kc)({ids:r},{refetchOnMountOrArgChange:!0}),i={products:r.map((e=>({id:e,quantity:t[e]}))).filter((e=>e.quantity>0)),status:m.R.Processing};return{products:null!==(e=null==s?void 0:s.data)&&void 0!==e?e:[],order:i,isFetching:n}})(),{create:y}=(()=>{const[e,{isLoading:t,isSuccess:r,error:s}]=(0,x.xj)(),n=(0,p.j)();(0,j.u)({error:s}),(0,v.j)({isSuccess:r,mess:"Order created successfully"});const i=(0,c.Zp)();return(0,f.useEffect)((()=>{r&&(n((0,h.sX)()),i(a.bw.category.path))}),[r]),{create:t=>{return r=void 0,s=void 0,i=function*(){yield e(t)},new((n=void 0)||(n=Promise))((function(e,t){function c(e){try{a(i.next(e))}catch(e){t(e)}}function o(e){try{a(i.throw(e))}catch(e){t(e)}}function a(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n((function(e){e(r)}))).then(c,o)}a((i=i.apply(r,s||[])).next())}));var r,s,n,i},isLoading:t,isSuccess:r}})(),{totalPrice:P,totalOldPrice:g,totalDiscount:k}=(e=>{const t=e.reduce(((e,t)=>{var r;return e.totalPrice+=t.price,e.totalOldPrice+=null!==(r=t.oldPrice)&&void 0!==r?r:t.price,e}),{totalPrice:0,totalOldPrice:0}),r=t.totalOldPrice>0?100*(t.totalOldPrice-t.totalPrice)/t.totalOldPrice:0;return{totalPrice:t.totalPrice,totalOldPrice:t.totalOldPrice,totalDiscount:Math.round(r)}})(t),C=(0,c.Zp)(),_=null!==(e=t.map((e=>({key:e.id,render:()=>(0,s.jsx)(o.AA,{product:e})}))))&&void 0!==e?e:[];return(0,s.jsxs)("div",{className:u.checkoutContainer,children:[(0,s.jsx)("h1",{children:"Checkout"}),(0,s.jsx)("p",{children:"Please review your items and proceed to payment."}),(0,s.jsx)(l.p,{items:_}),(0,s.jsxs)("div",{className:u.summary,children:[(0,s.jsx)("h2",{children:"Order Summary"}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{children:"Total Price:"})," ",(0,s.jsx)("span",{children:(0,d.$)(P)})]}),g>P&&(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{children:"Old Price:"}),(0,s.jsx)("span",{className:u.oldPrice,children:(0,d.$)(g)})]}),k>0&&(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{children:"Discount:"})," ",(0,s.jsxs)("span",{className:u.discount,children:[k,"%"]})]})]}),(0,s.jsx)(n.A,{}),(0,s.jsxs)(i.Ay.Group,{children:[(0,s.jsx)(i.Ay,{onClick:()=>C(a.bw.cart.path),className:u.button,children:"Back to cart"}),(0,s.jsx)(i.Ay,{onClick:()=>{y(r)},className:u.button,children:"Create order"})]})]})},P=()=>(0,s.jsx)(y,{})},7231:(e,t,r)=>{r.d(t,{u:()=>c});var s=r(6540),n=r(3448),i=r(5515);const c=({form:e,error:t})=>{const{showError:r}=(0,n.J)();(0,s.useEffect)((()=>{if(t){(0,i.jS)(t),e&&e.setFields((0,i.z6)(t));const s=(0,i.bu)(t);s&&r(s)}}),[t,e,r])}},3448:(e,t,r)=>{r.d(t,{J:()=>i});var s=r(6540),n=r(582);const i=()=>{const e=(0,s.useContext)(n.N);if(!e)throw new Error("useMessage должен использоваться внутри <MessageProvider>");return e}},1458:(e,t,r)=>{r.d(t,{j:()=>i});var s=r(6540),n=r(3448);const i=({isSuccess:e,mess:t})=>{const{showSuccess:r}=(0,n.J)();(0,s.useEffect)((()=>{e&&r(t)}),[e,t,r])}},4274:(e,t,r)=>{r.d(t,{p:()=>i});var s=r(4848),n=r(6540);const i=({isGrid:e,items:t,lastItemRef:r,onLastItemChanged:n})=>0===t.length?(0,s.jsx)("div",{className:"RenderList-module_empty-VeKxm",children:"No items to display"}):(0,s.jsx)("ul",{className:void 0===e||e?"RenderList-module_listGrid-VEEh9":"RenderList-module_list-BF_R0",children:t.map(((e,i)=>(0,s.jsx)(o,{item:e,ref:a({items:t,index:i,lastItemRef:r,onLastItemChanged:n})},e.key)))}),c=(0,n.forwardRef)((({item:e},t)=>(0,s.jsx)("li",{id:e.key,ref:t,className:"RenderList-module_listItem-d2Xxn",children:e.render()})));c.displayName="ItemRef";const o=(0,n.memo)(c),a=({items:e,index:t,lastItemRef:r,onLastItemChanged:s})=>n=>{t===e.length-1&&r&&(r.current=n,s&&s(e[e.length-1].key))}}}]);
//# sourceMappingURL=337.f15f570ffd43d8316965.js.map
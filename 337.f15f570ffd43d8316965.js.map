{"version":3,"file":"337.f15f570ffd43d8316965.js","mappings":"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","sources":["webpack://app-store/./src/entities/Order/types/order.ts","webpack://app-store/./src/features/Checkout/ui/Checkout.module.scss?0e5a","webpack://app-store/./src/features/Checkout/model/useCreate.ts","webpack://app-store/./src/features/Checkout/ui/Checkout.tsx","webpack://app-store/./src/features/Checkout/model/useCheckout.ts","webpack://app-store/./src/features/Checkout/lib/calculateTotals.ts","webpack://app-store/./src/pages/CheckoutPage/CheckoutPage.tsx","webpack://app-store/./src/shared/api/errors/useErrorHandler.ts","webpack://app-store/./src/shared/hooks/useMessage.ts","webpack://app-store/./src/shared/hooks/useSuccessHandler.ts","webpack://app-store/./src/shared/ui/RenderList/RenderList.module.scss?5ddc","webpack://app-store/./src/shared/ui/RenderList/RenderList.tsx"],"sourcesContent":["export type Order = {\n  id: string;\n  products: {\n    product?: {\n      name: string;\n      price: number;\n    };\n    quantity: number;\n  }[];\n  status: OrderStatus;\n  createdAt: string;\n};\n\nexport type OrderFilters = {\n  productIds?: string[];\n  userId?: string;\n  ids?: string[];\n  status?: OrderStatus;\n  pagination?: {\n    pageSize?: number;\n    pageNumber?: number;\n  };\n  createdAt?: {\n    gte?: string;\n    lte?: string;\n  };\n  updatedAt?: {\n    gte?: string;\n    lte?: string;\n  };\n  sorting?: {\n    type: 'ASC' | 'DESC';\n    field: 'id' | 'createdAt' | 'updatedAt' | 'name' | 'date';\n  };\n};\n\nexport type CreateBody = {\n  products: {\n    id: string;\n    quantity: number;\n  }[];\n  status?: OrderStatus;\n};\n\nexport type UpdateBody = {\n  id: string;\n  productIds?: string[];\n  status?: OrderStatus;\n};\n\nexport type Result = {\n  data: Order[];\n  pagination: {\n    pageSize: number;\n    pageNumber: number;\n    total: number;\n  };\n  sorting: {\n    type: 'ASC' | 'DESC';\n    field: 'id' | 'createdAt' | 'updatedAt' | 'name';\n  };\n};\n\nexport enum OrderStatus {\n  PendingConfirmation = 'pending_confirmation',\n  Processing = 'processing',\n  Packaging = 'packaging',\n  WaitingForDelivery = 'waiting_for_delivery',\n  InTransit = 'in_transit',\n  Delivered = 'delivered',\n  ReturnRequested = 'return_requested',\n  OrderCancelled = 'order_cancelled',\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"checkoutContainer\":\"Checkout-module_checkoutContainer-YEQ2J\",\"summary\":\"Checkout-module_summary-V1wtx\",\"oldPrice\":\"Checkout-module_oldPrice-mRnhp\",\"discount\":\"Checkout-module_discount-q0fSi\"};","import { useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useCreateOrderMutation } from 'src/entities/Order/model/orderApi';\nimport { CreateBody } from 'src/entities/Order/types/order';\nimport { clearCart } from 'src/features/Cart/model/cartSlice';\nimport { useErrorHandler } from 'src/shared/api/errors/useErrorHandler';\nimport { ROUTES } from 'src/shared/config/routes';\nimport { useAppDispatch } from 'src/shared/hooks/store';\nimport { useSuccessHandler } from 'src/shared/hooks/useSuccessHandler';\n\nexport const useCreate = () => {\n  const [createOrder, { isLoading, isSuccess, error }] = useCreateOrderMutation();\n  const dispatch = useAppDispatch();\n  useErrorHandler({ error });\n  useSuccessHandler({\n    isSuccess,\n    mess: 'Order created successfully',\n  });\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    if (isSuccess) {\n      dispatch(clearCart());\n      navigate(ROUTES.category.path);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isSuccess]);\n\n  const create = async (body: CreateBody) => {\n    await createOrder(body);\n  };\n\n  return {\n    create,\n    isLoading,\n    isSuccess,\n  };\n};\n","import React from 'react';\nimport { Button, Divider } from 'antd';\nimport { useNavigate } from 'react-router-dom';\nimport { ProductCard } from 'src/entities/Product';\nimport { ROUTES } from 'src/shared/config/routes';\nimport { formatPrice } from 'src/shared/lib/formats/formatPrice';\nimport { IRenderItem } from 'src/shared/ui/RenderList/IRenderItem';\nimport { RenderList } from 'src/shared/ui/RenderList/RenderList';\nimport styles from './Checkout.module.scss';\nimport { calculateTotals } from '../lib/calculateTotals';\nimport { useCheckout } from '../model/useCheckout';\nimport { useCreate } from '../model/useCreate';\n\nexport const Checkout: React.FC = () => {\n  const { products, order } = useCheckout();\n  const { create } = useCreate();\n  const { totalPrice, totalOldPrice, totalDiscount } = calculateTotals(products);\n  const navigate = useNavigate();\n\n  const items: IRenderItem[] =\n    products.map((product) => ({\n      key: product.id,\n      render: () => <ProductCard product={product} />,\n    })) ?? [];\n\n  const handleCreate = () => {\n    create(order);\n  };\n\n  return (\n    <div className={styles.checkoutContainer}>\n      <h1>Checkout</h1>\n      <p>Please review your items and proceed to payment.</p>\n\n      <RenderList items={items} />\n\n      <div className={styles.summary}>\n        <h2>Order Summary</h2>\n        <p>\n          <span>Total Price:</span> <span>{formatPrice(totalPrice)}</span>\n        </p>\n        {totalOldPrice > totalPrice && (\n          <p>\n            <span>Old Price:</span>\n            <span className={styles.oldPrice}>{formatPrice(totalOldPrice)}</span>\n          </p>\n        )}\n        {totalDiscount > 0 && (\n          <p>\n            <span>Discount:</span> <span className={styles.discount}>{totalDiscount}%</span>\n          </p>\n        )}\n      </div>\n      <Divider />\n      <Button.Group>\n        <Button onClick={() => navigate(ROUTES.cart.path)} className={styles.button}>\n          Back to cart\n        </Button>\n        <Button onClick={handleCreate} className={styles.button}>\n          Create order\n        </Button>\n      </Button.Group>\n    </div>\n  );\n};\n","import { CreateBody, OrderStatus } from 'src/entities/Order/types/order';\nimport { useGetProductsQuery } from 'src/entities/Product';\nimport { selectCartItems } from 'src/features/Cart/model/cartSlice';\nimport { useAppSelector } from 'src/shared/hooks/store';\n\nexport const useCheckout = () => {\n  const cartItems = useAppSelector((state) => selectCartItems(state));\n  const ids = Object.keys(cartItems);\n  const { data, isFetching } = useGetProductsQuery({ ids }, { refetchOnMountOrArgChange: true });\n\n  const order: CreateBody = {\n    products: ids\n      .map((id) => ({\n        id,\n        quantity: cartItems[id],\n      }))\n      .filter((item) => item.quantity > 0),\n    status: OrderStatus.Processing,\n  };\n\n  const products = data?.data ?? [];\n\n  return {\n    products,\n    order,\n    isFetching,\n  };\n};\n","import { Product } from 'src/entities/Product';\n\nexport const calculateTotals = (products: Product[]) => {\n  const totals = products.reduce(\n    (acc, product) => {\n      acc.totalPrice += product.price;\n      acc.totalOldPrice += product.oldPrice ?? product.price;\n      return acc;\n    },\n    { totalPrice: 0, totalOldPrice: 0 },\n  );\n\n  const totalDiscount =\n    totals.totalOldPrice > 0\n      ? ((totals.totalOldPrice - totals.totalPrice) * 100) / totals.totalOldPrice\n      : 0;\n\n  return {\n    totalPrice: totals.totalPrice,\n    totalOldPrice: totals.totalOldPrice,\n    totalDiscount: Math.round(totalDiscount),\n  };\n};\n","import { Checkout } from 'src/features/Checkout';\n\nconst CheckoutPage: React.FC = () => {\n  return <Checkout />;\n};\n\nexport default CheckoutPage;\n","import { useEffect } from 'react';\nimport { FormInstance } from 'antd';\nimport { useMessage } from 'src/shared/hooks/useMessage';\nimport { extractFormErrors, extractWithoutFiledErrors, throwIfGlobalError } from './errorParser';\n\nexport interface UseErrorHandlerProps<TFields> {\n  error: unknown;\n  form?: FormInstance<TFields>;\n}\n\nexport const useErrorHandler = <TFields>({ form, error }: UseErrorHandlerProps<TFields>) => {\n  const { showError } = useMessage();\n\n  useEffect(() => {\n    if (error) {\n      throwIfGlobalError(error);\n\n      if (form) {\n        form.setFields(extractFormErrors(error));\n      }\n\n      const joinedMessage = extractWithoutFiledErrors(error);\n      if (joinedMessage) {\n        showError(joinedMessage);\n      }\n    }\n  }, [error, form, showError]);\n};\n","import { useContext } from 'react';\nimport { MessageContext } from 'src/shared/providers/MessageContext';\n\nexport const useMessage = () => {\n  const context = useContext(MessageContext);\n  if (!context) {\n    throw new Error('useMessage должен использоваться внутри <MessageProvider>');\n  }\n  return context;\n};\n","import { useEffect } from 'react';\nimport { useMessage } from './useMessage';\n\ninterface UseSuccessHandlerProps {\n  isSuccess: boolean;\n  mess: string;\n}\n\nexport const useSuccessHandler = ({ isSuccess, mess }: UseSuccessHandlerProps) => {\n  const { showSuccess } = useMessage();\n\n  useEffect(() => {\n    if (isSuccess) {\n      showSuccess(mess);\n    }\n  }, [isSuccess, mess, showSuccess]);\n};\n","// extracted by mini-css-extract-plugin\nexport default {\"list\":\"RenderList-module_list-BF_R0\",\"listGrid\":\"RenderList-module_listGrid-VEEh9\",\"listItem\":\"RenderList-module_listItem-d2Xxn\",\"empty\":\"RenderList-module_empty-VeKxm\"};","import React, { forwardRef, memo } from 'react';\nimport { IRenderItem } from './IRenderItem';\nimport styles from './RenderList.module.scss';\n\nexport interface IRenderListProps {\n  isGrid?: boolean;\n  items: IRenderItem[];\n  lastItemRef?: React.RefObject<HTMLLIElement | null>;\n  onLastItemChanged?: (key: string) => void;\n}\n\nexport const RenderList: React.FC<IRenderListProps> = ({\n  isGrid,\n  items,\n  lastItemRef,\n  onLastItemChanged,\n}) => {\n  if (items.length === 0) {\n    return <div className={styles.empty}>No items to display</div>;\n  }\n\n  return (\n    <ul className={isGrid === undefined || isGrid ? styles.listGrid : styles.list}>\n      {items.map((item, index) => (\n        <ItemMemo\n          key={item.key}\n          item={item}\n          ref={setRefForLast({ items, index, lastItemRef, onLastItemChanged })}\n        />\n      ))}\n    </ul>\n  );\n};\n\ntype ListItemProps = {\n  item: IRenderItem;\n};\n\nconst ItemRef = forwardRef<HTMLLIElement, ListItemProps>(({ item }, ref) => (\n  <li id={item.key} ref={ref} className={styles.listItem}>\n    {item.render()}\n  </li>\n));\nItemRef.displayName = 'ItemRef';\n\nconst ItemMemo = memo(ItemRef);\n\nconst setRefForLast = ({\n  items,\n  index,\n  lastItemRef,\n  onLastItemChanged,\n}: {\n  items: IRenderItem[];\n  index: number;\n  onLastItemChanged?: (key: string) => void;\n  lastItemRef?: React.RefObject<HTMLLIElement | null>;\n}) => {\n  return (element: HTMLLIElement | null) => {\n    if (index === items.length - 1 && lastItemRef) {\n      lastItemRef.current = element;\n      if (onLastItemChanged) {\n        onLastItemChanged(items[items.length - 1].key);\n      }\n    }\n  };\n};\n"],"names":["OrderStatus","Checkout","products","order","cartItems","state","ids","Object","keys","data","isFetching","refetchOnMountOrArgChange","map","id","quantity","filter","item","status","Processing","useCheckout","create","createOrder","isLoading","isSuccess","error","dispatch","useErrorHandler","u","useSuccessHandler","mess","navigate","useEffect","category","path","body","useCreate","totalPrice","totalOldPrice","totalDiscount","totals","reduce","acc","product","price","oldPrice","Math","round","calculateTotals","items","key","render","Product","className","checkoutContainer","RenderList","summary","formatPrice","discount","Group","onClick","cart","button","form","showError","setFields","joinedMessage","useMessage","context","useContext","Error","showSuccess","isGrid","lastItemRef","onLastItemChanged","length","undefined","index","ItemMemo","ref","setRefForLast","ItemRef","forwardRef","displayName","memo","element","current"],"sourceRoot":""}
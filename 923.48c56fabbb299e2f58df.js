"use strict";(self.webpackChunkapp_store=self.webpackChunkapp_store||[]).push([[923],{4923:(e,t,s)=>{s.r(t),s.d(t,{default:()=>v});var r=s(4848),a=s(6552),n=s(4716),i=s(5662),o=s(3001),d=s(6409),c=s(2702),l=s(4547);const u=({category:e,onClick:t,onRemove:s,onEdit:n})=>{const i=e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget.dataset.type;"delete"===t&&s?s():"edit"===t&&n&&n()};return(0,r.jsxs)(o.A,{className:"CategoryCard-module_categoryCard-PW2qj",onClick:()=>{t&&t()},children:[e.photo&&(0,r.jsx)(d.A,{className:"CategoryCard-module_photo-HGATH",preview:!1,src:e.photo,alt:e.name}),(0,r.jsx)("p",{className:"CategoryCard-module_title-y4FNh",children:e.name}),(n||s)&&(0,r.jsx)(a.A,{}),(0,r.jsxs)(c.A,{className:"CategoryCard-module_buttonSpace-uAT6I",children:[n&&(0,r.jsx)(l.Ay,{datatype:"edit",onClick:i,children:"Edit"}),s&&(0,r.jsx)(l.Ay,{datatype:"delete",danger:!0,onClick:i,children:"Delete"})]})]})};var m=s(294),h=s(6540),g=s(4753),f=s(7231);const p={list:"RenderList-module_list-BF_R0",listGrid:"RenderList-module_listGrid-VEEh9",listItem:"RenderList-module_listItem-d2Xxn"},C=({isGrid:e,items:t,lastItemRef:s,onLastItemChanged:a})=>0===t.length?(0,r.jsx)("div",{className:p.empty,children:"No items to display"}):(0,r.jsx)("ul",{className:`${p.list} ${e?p.listGrid:""}`,children:t.map(((e,n)=>(0,r.jsx)(x,{item:e,ref:j({items:t,index:n,lastItemRef:s,onLastItemChanged:a})},e.key)))}),y=(0,h.forwardRef)((({item:e},t)=>(0,r.jsx)("li",{id:e.key,ref:t,className:p.listItem,children:e.render()})));y.displayName="ItemRef";const x=(0,h.memo)(y),j=({items:e,index:t,lastItemRef:s,onLastItemChanged:r})=>a=>{t===e.length-1&&s&&(s.current=a,r(e[e.length-1].key))},I=({isGrid:e,items:t,onLastItem:s})=>{const[a,n]=(0,h.useState)(""),i=(0,h.useRef)(""),o=(0,h.useRef)(null),d=(0,h.useRef)(!1),c=(0,h.useCallback)((e=>{const t=e[0];(null==t?void 0:t.isIntersecting)&&!d.current&&(d.current=!0,s())}),[s]);return(0,h.useEffect)((()=>{if(a===i.current)return;i.current=a;const e=new IntersectionObserver(c,{threshold:.5}),t=o.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}}),[c,a]),(0,h.useEffect)((()=>{d.current=!1}),[a]),(0,r.jsx)(C,{isGrid:e,items:t,lastItemRef:o,onLastItemChanged:n})},k=()=>{const{hasMore:e,isFetching:t,items:s,handleLastItem:o}=(e=>{const t=(0,h.useRef)([]),[s,a]=(0,h.useState)(1),[n,i]=(0,h.useState)(!0),[o,d]=(0,h.useState)([]),{data:c,isFetching:l,isLoading:p,error:C,refetch:y}=e({pagination:{pageSize:10,pageNumber:s}},{skip:0===s||t.current.includes(s)});(0,f.u)({error:C});const x=(0,g.Zp)(),j=(0,h.useCallback)((()=>{n&&!l&&a((e=>e+1))}),[n,l]);return(0,h.useEffect)((()=>{p&&l&&d([])}),[l,p]),(0,h.useEffect)((()=>{c&&c.data.length>0&&!t.current.includes(s)&&c.pagination.pageNumber===s?(t.current.push(s),d((e=>[...e,...c.data.map((e=>((e,t)=>(({category:e,onClick:t,onEdit:s,onDelete:a})=>({key:e.id,render:()=>(0,r.jsx)(u,{category:e,onClick:t?()=>t(e.id):void 0,onEdit:s?()=>s(e.id):void 0,onRemove:a?()=>a(e.id):void 0})}))({category:e,onClick:()=>t(`${m.bw.products.basePath}${e.id}`)}))(e,x)))]))):c&&c.data.length<10&&i(!1)}),[c,s]),{isFetching:l,hasMore:n,items:o,refetch:y,handleLastItem:j}})(i.Wm);return(0,r.jsxs)("div",{className:"CategoryList-module_container-JHTbf",children:[(0,r.jsx)(I,{isGrid:!0,items:s,onLastItem:o}),!e&&(0,r.jsx)("p",{className:"CategoryList-module_end-M57dM",children:"Все категории загружены"}),t&&(0,r.jsx)(a.A,{}),t&&(0,r.jsx)(n.A,{})]})},v=()=>(0,r.jsx)(k,{})},7231:(e,t,s)=>{s.d(t,{u:()=>i});var r=s(6540),a=s(3448),n=s(5515);const i=({form:e,error:t})=>{const{showError:s}=(0,a.J)();(0,r.useEffect)((()=>{if(t){(0,n.jS)(t),e&&e.setFields((0,n.z6)(t));const r=(0,n.bu)(t);r&&s(r)}}),[t,e])}},3448:(e,t,s)=>{s.d(t,{J:()=>n});var r=s(6540),a=s(582);const n=()=>{const e=(0,r.useContext)(a.N);if(!e)throw new Error("useMessage должен использоваться внутри <MessageProvider>");return e}}}]);
//# sourceMappingURL=923.48c56fabbb299e2f58df.js.map
"use strict";(self.webpackChunkapp_store=self.webpackChunkapp_store||[]).push([[607],{7607:(e,t,s)=>{s.r(t),s.d(t,{default:()=>k});var r=s(4848),a=s(6552),n=s(4716),i=s(6540);const o={list:"RenderList-module_list-BF_R0",listGrid:"RenderList-module_listGrid-VEEh9",listItem:"RenderList-module_listItem-d2Xxn"},d=({isGrid:e,items:t,lastItemRef:s,onLastItemChanged:a})=>0===t.length?(0,r.jsx)("div",{className:o.empty,children:"No items to display"}):(0,r.jsx)("ul",{className:`${o.list} ${e?o.listGrid:""}`,children:t.map(((e,n)=>(0,r.jsx)(l,{item:e,ref:u({items:t,index:n,lastItemRef:s,onLastItemChanged:a})},e.key)))}),c=(0,i.forwardRef)((({item:e},t)=>(0,r.jsx)("li",{id:e.key,ref:t,className:o.listItem,children:e.render()})));c.displayName="ItemRef";const l=(0,i.memo)(c),u=({items:e,index:t,lastItemRef:s,onLastItemChanged:r})=>a=>{t===e.length-1&&s&&(s.current=a,r(e[e.length-1].key))},m=({isGrid:e,items:t,onLastItem:s})=>{const[a,n]=(0,i.useState)(""),o=(0,i.useRef)(""),c=(0,i.useRef)(null),l=(0,i.useRef)(!1),u=(0,i.useCallback)((e=>{const t=e[0];(null==t?void 0:t.isIntersecting)&&!l.current&&(l.current=!0,s())}),[s]);return(0,i.useEffect)((()=>{if(a===o.current)return;o.current=a;const e=new IntersectionObserver(u,{threshold:.5}),t=c.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}}),[u,a]),(0,i.useEffect)((()=>{l.current=!1}),[a]),(0,r.jsx)(d,{isGrid:e,items:t,lastItemRef:c,onLastItemChanged:n})};var h=s(4753),g=s(5662),f=s(3001),p=s(6409),C=s(2702),y=s(4547);const x=({category:e,onClick:t,onRemove:s,onEdit:n})=>{const i=e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget.dataset.type;"delete"===t&&s?s():"edit"===t&&n&&n()};return(0,r.jsxs)(f.A,{className:"CategoryCard-module_categoryCard-PW2qj",onClick:()=>{t&&t()},children:[e.photo&&(0,r.jsx)(p.A,{className:"CategoryCard-module_photo-HGATH",preview:!1,src:e.photo,alt:e.name}),(0,r.jsx)("p",{className:"CategoryCard-module_title-y4FNh",children:e.name}),(n||s)&&(0,r.jsx)(a.A,{}),(0,r.jsxs)(C.A,{className:"CategoryCard-module_buttonSpace-uAT6I",children:[n&&(0,r.jsx)(y.Ay,{datatype:"edit",onClick:i,children:"Edit"}),s&&(0,r.jsx)(y.Ay,{datatype:"delete",danger:!0,onClick:i,children:"Delete"})]})]})};var j=s(7231),v=s(294);const I=()=>{const{hasMore:e,isFetching:t,categories:s,handleLastItem:o}=(()=>{const e=(0,i.useRef)([]),[t,s]=(0,i.useState)(1),[a,n]=(0,i.useState)(!0),[o,d]=(0,i.useState)([]),{data:c,isFetching:l,isLoading:u,error:m,refetch:f}=(0,g.Wm)({pagination:{pageSize:10,pageNumber:t}},{skip:0===t||e.current.includes(t)});(0,j.u)({error:m});const p=(0,h.Zp)(),C=(0,i.useCallback)((()=>{a&&!l&&s((e=>e+1))}),[a,l]);return(0,i.useEffect)((()=>{u&&l&&d([])}),[l,u]),(0,i.useEffect)((()=>{c&&c.data.length>0&&!e.current.includes(t)&&c.pagination.pageNumber===t?(e.current.push(t),d((e=>[...e,...c.data.map((e=>(({category:e,onClick:t,onEdit:s,onDelete:a})=>({key:e.id,render:()=>(0,r.jsx)(x,{category:e,onClick:t?()=>t(e.id):void 0,onEdit:s?()=>s(e.id):void 0,onRemove:a?()=>a(e.id):void 0})}))({category:e,onClick:()=>p(`${v.bw.products.basePath}${e.id}`)})))]))):c&&c.data.length<10&&n(!1)}),[c,t]),{isFetching:l,hasMore:a,categories:o,refetch:f,handleLastItem:C}})();return(0,r.jsxs)("div",{className:"CategoryList-module_container-JHTbf",children:[(0,r.jsx)(m,{isGrid:!0,items:s,onLastItem:o}),!e&&(0,r.jsx)("p",{className:"CategoryList-module_end-M57dM",children:"Все категории загружены"}),t&&(0,r.jsx)(a.A,{}),t&&(0,r.jsx)(n.A,{})]})},k=()=>(0,r.jsx)(I,{})},7231:(e,t,s)=>{s.d(t,{u:()=>i});var r=s(6540),a=s(3448),n=s(5515);const i=({form:e,error:t})=>{const{showError:s}=(0,a.J)();(0,r.useEffect)((()=>{if(t){(0,n.jS)(t),e&&e.setFields((0,n.z6)(t));const r=(0,n.bu)(t);r&&s(r)}}),[t,e])}},3448:(e,t,s)=>{s.d(t,{J:()=>n});var r=s(6540),a=s(582);const n=()=>{const e=(0,r.useContext)(a.N);if(!e)throw new Error("useMessage должен использоваться внутри <MessageProvider>");return e}}}]);
//# sourceMappingURL=607.eb6c7a27ddc0cd5dd8f6.js.map
"use strict";(self.webpackChunkapp_store=self.webpackChunkapp_store||[]).push([[331],{2331:(e,t,n)=>{n.r(t),n.d(t,{default:()=>C});var s=n(4848),r=n(6540),a=n(2702),i=n(515),o=n(3903),c=n(6552),d=n(4716),l=n(429),u=n(9220),m=n(4931);const h=e=>({name:[{required:!0,message:"Please enter a name"},{min:3,max:20,message:"Name must be between 3 and 20 characters"},{pattern:/^[a-zA-Z0-9\s]+$/,message:"Name can only contain letters, numbers, and spaces"}],photo:[{pattern:/^(https?:\/\/.*\.(?:png|jpg|jpeg|gif|webp|svg))$/i,message:"Invalid photo URL",validateTrigger:"onSubmit"}]}[e]);var p=n(7231),f=n(1458);const x="create",g="update",j=({action:e,productId:t,onCreated:n})=>{const[a,o]=(0,r.useState)(e===x),[c]=u.A.useForm(),{data:j,isFetching:v}=((e,t,n)=>{const{data:s,refetch:r,isFetching:a,isSuccess:i,error:o}=(0,l.Kc)({ids:[t]},{skip:e});return(0,p.u)({form:n,error:o}),{data:s,refetch:r,isFetching:a,isSuccess:i}})(e===x,t,c),{update:y,isUpdating:C,isUpdateSuccess:A}=(e=>{const[t,{isLoading:n,isSuccess:s,error:r}]=(0,l.vM)();return(0,p.u)({form:e,error:r}),(0,f.j)({isSuccess:s,mess:"Data saved successfully"}),{update:()=>{return n=void 0,s=void 0,a=function*(){const n=e.getFieldsValue();yield t(n)},new((r=void 0)||(r=Promise))((function(e,t){function i(e){try{c(a.next(e))}catch(e){t(e)}}function o(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,o)}c((a=a.apply(n,s||[])).next())}));var n,s,r,a},isUpdating:n,isUpdateSuccess:s}})(c),{create:w,isCreating:I,isCreatingSuccess:b}=(e=>{const[t,{isLoading:n,isSuccess:s,error:r}]=(0,l.Q$)();return(0,p.u)({form:e,error:r}),(0,f.j)({isSuccess:s,mess:"Product created successfully"}),{create:()=>{return n=void 0,s=void 0,a=function*(){const n=e.getFieldsValue();yield t(n)},new((r=void 0)||(r=Promise))((function(e,t){function i(e){try{c(a.next(e))}catch(e){t(e)}}function o(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,o)}c((a=a.apply(n,s||[])).next())}));var n,s,r,a},isCreating:n,isCreatingSuccess:s}})(c);return(0,r.useEffect)((()=>{j&&c.setFieldsValue(j.data[0])}),[j,c]),(0,r.useEffect)((()=>{b&&n()}),[b,n]),(0,r.useEffect)((()=>{A&&o(!1)}),[A]),(0,s.jsxs)(u.A,{form:c,name:"ProductForm",labelAlign:"left",labelCol:{span:8},wrapperCol:{span:16},onFinish:e===g?y:w,autoComplete:"off",children:[(0,s.jsx)(u.A.Item,{label:"Id",name:"id",children:(0,s.jsx)(m.A,{readOnly:!0,hidden:e===x})}),(0,s.jsx)(u.A.Item,{label:"Name",name:"name",rules:h("name"),children:(0,s.jsx)(m.A,{onChange:()=>o(!0),placeholder:"Snowboarding"})}),(0,s.jsx)(u.A.Item,{label:"Photo source",name:"photo",rules:h("photo"),children:(0,s.jsx)(m.A,{onChange:()=>o(!0),placeholder:"URL"})}),(0,s.jsx)(u.A.Item,{label:"Description",name:"desc",children:(0,s.jsx)(m.A.TextArea,{onChange:()=>o(!0),placeholder:"Description"})}),(0,s.jsx)(u.A.Item,{label:"Old price",name:"oldPrice",children:(0,s.jsx)(m.A,{onChange:()=>o(!0),placeholder:"Old price"})}),(0,s.jsx)(u.A.Item,{label:"Price",name:"price",children:(0,s.jsx)(m.A,{onChange:()=>o(!0),placeholder:"Price"})}),(0,s.jsx)(u.A.Item,{label:"CategoryId",name:"categoryId",children:(0,s.jsx)(m.A,{onChange:()=>o(!0),placeholder:"CategoryId"})}),(0,s.jsx)(i.Ay,{type:"primary",htmlType:"submit",style:{width:"100%"},disabled:v||C||!a,children:C||I?(0,s.jsx)(d.A,{}):e===g?"Save":"Create"})]})};var v=n(4274);const y=()=>{var e;const[t,n]=(0,r.useState)(null),{data:u,error:m}=(0,l.r3)(),[h,{isLoading:y,isSuccess:C,error:A}]=(0,l.lY)();(0,p.u)({error:m}),(0,p.u)({error:A}),(0,f.j)({isSuccess:C,mess:"Product delete successfully"});const w=(0,r.useCallback)((e=>(0,s.jsxs)(a.A,{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,s.jsx)(i.Ay,{onClick:()=>{n({action:g,product:e})},children:"Edit"}),(0,s.jsx)(i.Ay,{danger:!0,onClick:()=>{return t=void 0,n=void 0,r=function*(){return yield h(e.id)},new((s=void 0)||(s=Promise))((function(e,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function o(e){try{c(r.throw(e))}catch(e){a(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(i,o)}c((r=r.apply(t,n||[])).next())}));var t,n,s,r},children:"Delete"})]})),[h]),I=(0,r.useCallback)((({product:e,onClick:t})=>({key:e.id,render:()=>(0,s.jsx)(l.AA,{product:e,onClick:t?()=>t(e.id):void 0,footer:()=>w?w(e):void 0})})),[w]),b=null!==(e=null==u?void 0:u.data.map((e=>I({product:e}))))&&void 0!==e?e:[];return(0,s.jsxs)("div",{className:"ProductEditor-module_container-HHjGH",children:[t&&(0,s.jsx)(o.A,{title:(0,s.jsx)("p",{children:"Edit product"}),open:Boolean(t),loading:!1,onCancel:()=>n(null),footer:(0,s.jsx)(s.Fragment,{}),children:(0,s.jsx)(j,{action:t.action,productId:t.product.id,onCreated:()=>{n(null)}})}),(0,s.jsx)("div",{children:(0,s.jsx)(i.Ay,{onClick:()=>{n({action:x,product:{id:"",name:"",createdAt:new Date(Date.now()),updatedAt:new Date(Date.now()),price:0,commandId:""}})},children:"Create new product"})}),(0,s.jsx)(c.A,{}),y&&(0,s.jsx)(d.A,{}),y&&(0,s.jsx)(c.A,{}),(0,s.jsx)(v.p,{items:b})]})},C=()=>(0,s.jsx)("div",{className:"ProductEditPage-module_page-Kbjhx",children:(0,s.jsx)(y,{})})},7231:(e,t,n)=>{n.d(t,{u:()=>i});var s=n(6540),r=n(3448),a=n(5515);const i=({form:e,error:t})=>{const{showError:n}=(0,r.J)();(0,s.useEffect)((()=>{if(t){(0,a.jS)(t),e&&e.setFields((0,a.z6)(t));const s=(0,a.bu)(t);s&&n(s)}}),[t,e,n])}},3448:(e,t,n)=>{n.d(t,{J:()=>a});var s=n(6540),r=n(582);const a=()=>{const e=(0,s.useContext)(r.N);if(!e)throw new Error("useMessage должен использоваться внутри <MessageProvider>");return e}},1458:(e,t,n)=>{n.d(t,{j:()=>a});var s=n(6540),r=n(3448);const a=({isSuccess:e,mess:t})=>{const{showSuccess:n}=(0,r.J)();(0,s.useEffect)((()=>{e&&n(t)}),[e,t,n])}},4274:(e,t,n)=>{n.d(t,{p:()=>a});var s=n(4848),r=n(6540);const a=({isGrid:e,items:t,lastItemRef:n,onLastItemChanged:r})=>0===t.length?(0,s.jsx)("div",{className:"RenderList-module_empty-VeKxm",children:"No items to display"}):(0,s.jsx)("ul",{className:void 0===e||e?"RenderList-module_listGrid-VEEh9":"RenderList-module_list-BF_R0",children:t.map(((e,a)=>(0,s.jsx)(o,{item:e,ref:c({items:t,index:a,lastItemRef:n,onLastItemChanged:r})},e.key)))}),i=(0,r.forwardRef)((({item:e},t)=>(0,s.jsx)("li",{id:e.key,ref:t,className:"RenderList-module_listItem-d2Xxn",children:e.render()})));i.displayName="ItemRef";const o=(0,r.memo)(i),c=({items:e,index:t,lastItemRef:n,onLastItemChanged:s})=>r=>{t===e.length-1&&n&&(n.current=r,s&&s(e[e.length-1].key))}}}]);
//# sourceMappingURL=331.03a512b2d3a85334684a.js.map